openapi: 3.0.0
info:
  title: Weather MCP Server
  description: |
    Model Context Protocol (MCP) server providing weather information.
    Built with ModelContextProtocol.AspNetCore SDK.
    The server automatically exposes MCP tools with auto-discovery.
  version: 1.0.0
  contact:
    name: MCP Weather Server
    
servers:
  - url: https://localhost:5000
    description: Local development server
  - url: https://your-apim-gateway.azure-api.net
    description: Production APIM endpoint

paths:
  /:
    post:
      summary: MCP Protocol Endpoint
      description: |
        Model Context Protocol endpoint for tool discovery and execution.
        Communicates using JSON-RPC 2.0 over HTTP with streaming support.
        Automatically discovers and exposes available tools via attributes.
      operationId: mcpEndpoint
      requestBody:
        required: true
        description: JSON-RPC 2.0 request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JsonRpcRequest"
      responses:
        "200":
          description: JSON-RPC 2.0 response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JsonRpcResponse"
        "400":
          description: Invalid JSON-RPC request

  /health:
    get:
      summary: Health Check
      description: Check if the server is running and healthy
      operationId: healthCheck
      responses:
        "200":
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                    example: 2026-02-18T16:57:43.248015Z

components:
  schemas:
    JsonRpcRequest:
      type: object
      required:
        - jsonrpc
        - method
        - id
      properties:
        jsonrpc:
          type: string
          enum: ["2.0"]
          description: JSON-RPC version
        method:
          type: string
          description: RPC method to invoke
          enum:
            - initialize
            - tools/list
            - tools/call
          example: tools/list
        params:
          type: object
          description: Method-specific parameters
          example:
            name: get_weather
            arguments:
              location: "New York"
        id:
          oneOf:
            - type: string
            - type: number
          description: Request identifier for correlating responses

    JsonRpcResponse:
      type: object
      properties:
        jsonrpc:
          type: string
          enum: ["2.0"]
          description: JSON-RPC version
        result:
          type: object
          description: Method result (on success)
          example:
            tools:
              - name: get_weather
                description: Get current and historical weather information for a specific location
        error:
          $ref: "#/components/schemas/JsonRpcError"
        id:
          oneOf:
            - type: string
            - type: number
          description: Request identifier matching the request

    JsonRpcError:
      type: object
      properties:
        code:
          type: integer
          enum:
            - -32700  # Parse error
            - -32600  # Invalid request
            - -32601  # Method not found
            - -32602  # Invalid params
            - -32603  # Internal error
          description: JSON-RPC error code
        message:
          type: string
          description: Error description
          example: Method not found
        data:
          type: object
          description: Additional error information

    Tool:
      type: object
      required:
        - name
        - description
        - inputSchema
      properties:
        name:
          type: string
          example: get_weather
          description: Unique tool identifier
        description:
          type: string
          example: Get current and historical weather information for a specific location
          description: Human-readable tool description
        inputSchema:
          $ref: "#/components/schemas/JsonSchema"

    JsonSchema:
      type: object
      properties:
        type:
          type: string
          enum:
            - object
            - string
            - number
            - integer
            - boolean
            - array
          example: object
        properties:
          type: object
          description: Object property definitions
          additionalProperties: true
        required:
          type: array
          items:
            type: string
          description: Required property names
          example:
            - location
        description:
          type: string
          description: Schema description

    WeatherData:
      type: object
      properties:
        location:
          type: string
          example: New York
          description: Location name
        temperature:
          type: number
          format: double
          description: Temperature in Fahrenheit
          example: 72.5
        humidity:
          type: integer
          description: Humidity percentage (0-100)
          example: 65
        condition:
          type: string
          example: Sunny
          description: Weather condition
        timestamp:
          type: string
          format: date-time
          example: 2026-02-18T16:57:43.248015Z
          description: ISO 8601 timestamp of the data

